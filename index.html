<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- FIX 1: Tell the browser to send a referrer to YouTube -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>TheBackstabber2 - Videos</title>
    <style>
        :root { --accent: #ff0000; --bg: #0f0f0f; --card: #1a1a1a; --text: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        header { background: #000; padding: 20px; text-align: center; border-bottom: 2px solid var(--accent); }
        .container { max-width: 1100px; margin: auto; padding: 20px; }
        .main-player-area { text-align: center; margin-bottom: 40px; }
        .video-container { 
            width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; 
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        iframe { width: 100%; height: 100%; border: none; }
        h2#video-title { margin-top: 20px; font-size: 1.4rem; color: #fff; }
        .controls { display: flex; justify-content: center; gap: 15px; margin: 20px 0; }
        button { 
            padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; 
            background: var(--card); color: white; font-weight: bold; transition: 0.3s;
            border: 1px solid #333;
        }
        button:hover:not(:disabled) { background: var(--accent); border-color: var(--accent); }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        h3 { border-left: 4px solid var(--accent); padding-left: 15px; margin-top: 50px; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .video-card { background: var(--card); border-radius: 8px; overflow: hidden; cursor: pointer; transition: 0.3s; border: 1px solid transparent; }
        .video-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .video-card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; }
        .video-card p { padding: 12px; font-size: 0.9rem; margin: 0; line-height: 1.4; height: 2.8em; overflow: hidden; }
    </style>
</head>
<body>

<header><h1>TheBackstabber2</h1></header>

<div class="container">
    <div class="main-player-area">
        <div class="video-container">
            <!-- FIX 2: Added referrerpolicy="strict-origin-when-cross-origin" -->
            <iframe id="player" 
                    src="" 
                    allowfullscreen 
                    allow="autoplay; encrypted-media; picture-in-picture" 
                    referrerpolicy="strict-origin-when-cross-origin"></iframe>
        </div>
        <h2 id="video-title">Loading...</h2>
        <div class="controls">
            <button id="prev" onclick="move(-1)">← Previous</button>
            <button id="next" onclick="move(1)">Next →</button>
        </div>
    </div>

    <h3>All Videos</h3>
    <div class="video-grid" id="grid"></div>
</div>

<script>
    const API_KEY = 'AIzaSyDxoxnwap0uSkNMZ54WontqYpVxAyGq0x0';
    const CHANNEL_ID = 'UCU7O6k72OIk7EcbR4M_iSJw';
    const VIDEOS_PLAYLIST_ID = CHANNEL_ID.replace('UC', 'UULF');
    
    let videos = [];
    let current = 0;

    async function init() {
        try {
            const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${VIDEOS_PLAYLIST_ID}&key=${API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            
            videos = data.items.filter(v => 
                !v.snippet.title.toLowerCase().includes('#shorts') && 
                !v.snippet.description.toLowerCase().includes('#shorts')
            );

            if (videos.length > 0) {
                render(0);
                renderGrid();
            }
        } catch (e) {
            document.getElementById('video-title').innerText = "Load Error. Try refreshing.";
        }
    }

    function render(index) {
        current = index;
        const v = videos[index].snippet;
        const id = v.resourceId.videoId;

        // FIX 3: Added 'origin' parameter to the URL to tell YouTube exactly where we are
        const currentOrigin = window.location.origin;
        document.getElementById('player').src = `https://www.youtube-nocookie.com/embed/${id}?rel=0&autoplay=1&origin=${currentOrigin}`;
        
        document.getElementById('video-title').innerText = v.title;
        document.getElementById('prev').disabled = (index === 0);
        document.getElementById('next').disabled = (index === videos.length - 1);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function move(step) {
        let n = current + step;
        if (n >= 0 && n < videos.length) render(n);
    }

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        videos.forEach((v, i) => {
            const card = document.createElement('div');
            card.className = 'video-card';
            card.onclick = () => render(i);
            card.innerHTML = `<img src="${v.snippet.thumbnails.medium.url}"><p>${v.snippet.title}</p>`;
            grid.appendChild(card);
        });
    }

    init();
</script>

</body>
</html>